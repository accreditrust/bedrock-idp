<div class="section section-keys" data-ng-controller="KeysController as model">
  <h3 class="headline">
    Keys
    <span data-ng-hide="model.state.loading" class="btn-group pull-right">
      <a class="btn"
        stackable-trigger="model.keysViewMenu"
        stackable-toggle="'active'">
        <i class="icon-reorder"></i>
      </a>
    </span>
    <span data-ng-show="model.state.loading" class="pull-right">
      <span data-spinner="model.state.loading" data-spinner-class="h3-spinner"></span>
    </span>
  </h3>
  <div stackable-popover="model.keysViewMenu"
    stackable-hide-arrow="true"
    stackable-placement="bottom"
    stackable-alignment="right">
    <ul class="stackable-menu">
      <li>
        <a class="stackable-cancel"
          data-ng-click="model.modals.showGenerateKeyPair=true"><i class="icon-plus"></i> Generate Key Pair</a>
      </li>
      <li>
        <a class="stackable-cancel"
          data-ng-click="model.modals.showAddKey=true"><i class="icon-plus"></i> Add Key</a>
      </li>
      <li>
        <a class="stackable-cancel"
          data-ng-click="model.showRevokedKeys=!model.showRevokedKeys"><i
          data-ng-show="model.showRevokedKeys" class="icon-ok"></i> Show Revoked Keys</a>
      </li>
    </ul>
  </div>
  <table class="table table-condensed" data-ng-show="model.state.loading || model.keys.length > 0">
    <thead>
      <tr>
        <th>Name</th>
        <th class="compact">Status</th>
        <th class="action">Action</th>
      </tr>
    </thead>
    <tbody data-ng-init="model.keyActionMenus = []">
      <tr data-ng-repeat="key in model.keys | orderBy:'label' | orderBy:'sysStatus':reverse"
        data-ng-show="key.sysStatus == 'active' || model.showRevokedKeys"
        data-ng-init="model.keyActionMenus[$index] = {}">
        <!-- Name -->
        <td>
          <a href="{{key.id}}">{{key.label}}</a>
          <span data-ng-show="model.identity.sysSigningKey == key.id"
            data-tooltip-title="This is the default signing key."
            data-placement="bottom" data-trigger="hover"><i class="icon icon-star"></i></span>
        </td>
        <!-- Status -->
        <td class="compact">
          <span data-ng-show="key.sysStatus == 'disabled'">Revoked</span>
          <span data-ng-show="key.sysStatus == 'active'">Active</span>
        </td>
        <!-- Action -->
        <td class="action">
          <div class="btn-group">
            <a href="#" class="btn"
              stackable-trigger="model.keyActionMenus[$index]"
              stackable-toggle="'active'">
              <i class="icon-chevron-down"></i>
            </a>
          </div>
          <div stackable-popover="model.keyActionMenus[$index]"
            stackable-hide-arrow="true"
            stackable-placement="bottom"
            stackable-alignment="right">
            <ul class="stackable-menu">
              <!-- Edit -->
              <li>
                <a class="stackable-cancel" data-ng-click="model.editKey(key)">
                  <i class="icon-pencil"></i> Edit
                </a>
              </li>
              <!-- Default Signing Key -->
              <li data-ng-show="model.identity.sysSigningKey != key.id && key.sysStatus == 'active'">
                <a class="stackable-cancel" data-ng-click="model.setDefaultSigningKeyId(key.id)">
                  <i class="icon-star"></i> Set as default
                </a>
              </li>
              <!-- Revoke -->
              <li class="divider" data-ng-hide="key.sysStatus == 'disabled'"></li>
              <li class="btn-danger" data-ng-hide="key.sysStatus == 'disabled'">
                <a class="stackable-cancel" data-ng-click="model.revokeKey(key)">
                  <i class="icon-remove"></i> Revoke
                </a>
              </li>
            </ul>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
  <div data-ng-show="!model.state.loading && model.keys.length == 0">
    <p class="center">You have no keys associated with this identity.
    Access keys can be added by using an external website or application
    or one can be generated that this site controls.</p>
  </div>
  <div stackable="model.modals.showGenerateKeyPair" stackable-modal="true">
    <div data-generate-key-pair-modal></div>
  </div>
  <div stackable="model.modals.showAddKey" stackable-modal="true">
    <div data-add-key-modal></div>
  </div>
  <div stackable="model.modals.showEditKey" stackable-modal="true">
    <div data-edit-key-modal data-key="model.modals.key"></div>
  </div>

  <!-- Revoking key alert -->
  <div stackable="model.modals.showRevokeKeyAlert" stackable-modal="true"
    stackable-closed="model.confirmRevokeKey(err, result)">
    <div data-alert-modal
      data-modal-header="Warning"
      data-modal-ok="Revoke"
      data-modal-cancel="Cancel">
      <div class="center alert">
        <strong>Warning!</strong>
        Revoking a key is permanent.
      </div>
      <p>Any functionality provided by this key will be invalidated and any
      applications that use this key will be disabled.
      You can re-enable your access and applications by registering a new
      key.</p>
      <p>Are you sure that you want to revoke this key?</p>
    </div>
  </div>
</div>
